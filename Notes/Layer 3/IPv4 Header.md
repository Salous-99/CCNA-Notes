![[Pasted image 20250630180106.png]]
IPv4 header.

It is organized in the following way:
- byte 0:
	- bits 0-3: Version of IP used, set to either 0100 or 0110 (4 and 6 in decimal)
	- bits 4-7: Internet header Length or IHL, shows length of the current header in multiples of four-bytes (meaning if IHL = 5, then the header is 5x4 = 20 bytes long). This field is necessary as the options field (last field in the header) is variable in length. The minimum length of a header is 20 bytes which means at minimum the IHL field will be equal to 5, and the maximum field is equal to 15x4 = 60 bytes.  
- byte 1:
	- bits 0-5: Differentiated services Code Point or DSCP. This is used for QoS, more on this later.
	- bits 6-7: Explicit Congestion Notification or ECN provides end-to-end notification of network congestion without dropping packets. This feature requires support from both parties as well as the underlying network infrastructure used.
- Bytes 2-3: Total length of the packet (including the layer 3 header) in bytes. Unlike IHL, there isn't a 4 multiplier. As such, since the minimum length of a header is 20 bytes, and the smallest possible packet has no encapsulated payload (just header), the minimum value of this field will be 20. The maximum will be 0xFFFF which is 65535 bytes.
- Bytes 4-5: two bytes constituting an ID for a packet. These are used (alongside the fragment offset) to reconstruct fragmented packets.* 
- Bytes 6-7:
	- bits 0-2: Control and identity fragments\*:
		- bit 0: reserved and set to 0
		- bit 1: Don't Fragment or DF bit. Used to indicate a packet that should not be fragmented
		- bit 2: More Fragments or MF bit. Set to 1 if there are more fragments in the packet, set to 0 if this fragment is the last one.
	- Bits 3-15*: The Fragment\* offset is used to indicate the position of the fragment within the original packet. 
- Byte 8: Number of hops the packet can be forwarded before being dropped. A router should drop packets with a TTL value of 0 and should decrement the TTL values of forwarded packets. This helps mitigate loops; if one packet keeps going in a loop endlessly, probably due to misconfiguration of some routing tables, it needlessly takes up bandwidth. Recommended default value for TTL is 64.
- Byte 9: protocol of encapsulated layer 4 PDU, typically this is either 6 for TCP, 17 for UDP, sometimes 1 for ICMP, and on some rare occasions 89 for OSPF (Open Shortest Path First) which is part of a routing protocol. More on that later. 
- Bytes 10-11: Just like the FCS in an Ethernet frame trailer, the header checksum field also contains a digest of the **packet header** that is compared with a digest generated by the receiver using the same algorithm in order to check for packet *header* integrity. The IPv4 protocol relies on the layer 4 protocols to do their own integrity checks (which UDP and TCP both do).
- Bytes 12-15: Source IP address
- Bytes 16-19: Destination IP address
- Bytes 20+: 0 bytes to a maximum size of 40 bytes. Typically not used. If the IHL is greater than 5, it means there are options to check out. Multiple options can be included and they are parsed as follows:
	- bit 0: set to 1 if options need to be copied into all fragments of a fragmented packet
	- bits 1-2: 0b00 or 0 for control options and 0b10 or 2 for debugging and measurement options. 1 and 3 are reserved.
	- bits 3-7: Option number (which option is being specified)
	- bits 8-15: Option length. This is used for parsing as this number also includes the field itself, and may not exist for simple options, this means that the receiver can read the option number, if it's a simple option, this field won't exist and the option itself can be read, if it does, read that many bytes into memory. ***The options field is beyond the scope of the CCNA.***

\*Packets are fragmented if their size exceeds the Maximum Transmission Unit or MTU which typically stands at 1500 bytes. Fragmented packets all have the same value in the identification field of their headers and they can be reassembled in accordance with the packet offset field so that they are assembled in the correct order.